# pretty colors
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ',*:Tc'

# vi mode
setw -g mode-keys vi

# start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Mac OS X fix for pbcopy, pbpaste, and launchctl
set-option -g default-command "~/.dotfiles/bin/safe-reattach-to-user-namespace -l $SHELL"

# enable mouse scrolling and selecting
set -g mouse on
set -g focus-events on

# Vi copypaste mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-selection

# hjkl pane traversal
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Setup 'v' to begin selection as in Vim
bind-key -T copy-mode-vi v send-keys -X begin-selection

# <Enter> in copy mode puts the text in system clipboard
# unbind -T copy-mode-vi Enter
# bind-key -T copy-mode-vi Enter send-keys -X copy-pipe 'reattach-to-user-namespace pbcopy'

# for mouse scroll to work on tmux 2.1
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

# Set the current working directory based on the current pane's current
# working directory (if set; if not, use the pane's starting directory)
# when creating # new windows and splits.
bind-key c new-window -c '#{pane_current_path}'
bind-key '"' split-window -c '#{pane_current_path}'
bind-key % split-window -h -c '#{pane_current_path}'

# set the maximum length of the session title in the status bar
set -g status-left-length 100

# Faster escape sequences (default is 500ms).
# This helps when exiting insert mode in Vim: http://superuser.com/a/252717/65504

set -sg escape-time 0
set -sg repeat-time 600

bind-key -r f run-shell "tmux neww ~/.dotfiles/scripts/tmux-sessionizer"

# if there's a TODO.md file in the current directory, open it, otherwise open my
# personal notes todo file in a new window
bind -r t neww -n "TODO" -c "#{pane_current_path}" "[[ -e TODO.md ]] && nvim TODO.md || nvim ~/notes/todo.md"

#quickly open Notes for editing
bind -r o neww -n "NOTES" -c "~/notes" "nvim -c ':Neotree'"

#quickly open dotfiles for editing
bind -r D neww -n "DOTFILES" -c "~/.dotfiles" "nvim -c ':Neotree'"

# open a new window for the editor
bind -r e neww -n "editor" "nvim"

# source this file after changes
bind R source-file ~/.tmux.conf

# Status bar customization
#
# Rose Pine Colors:
#
# To check the palette visit: https://rosepinetheme.com/palette/

# --- Palette ---
set -g @bg_window     '#191724'
set -g @fg_muted      '#6e6a86'
set -g @fg_active     '#87ffaf'
set -g @fg_activity   '#afff00'
set -g @black         '#000000'
set -g @rose          '#ebbcba'
set -g @love          '#eb6f92'
set -g @cyan          '#9ccfd8'
set -g @dark_purple   '#26233a'
set -g @purple        '#c4a7e7'
set -g @lavender      '#e0def4'
set -g @highlight_high '#524f67'

# --- Status bar defaults ---
set -g -F status-style "fg=#{@fg_muted},bg=#{@bg_window},none"
set -g -F status-bg '#{@bg_window}'

# Window styles
setw -g -F window-status-style "fg=#{@fg_active},bg=#{@bg_window},none"
setw -g -F window-status-activity-style "fg=#{@fg_activity},bg=#{@bg_window},none"
setw -g window-status-separator ''

# --- Left side ---
set -g status-left "#[none,fg=#{@black},bg=#{@purple},bold] #S #[none,fg=#{@purple},bg=#{@bg_window}]"

# --- Right side ---
set -g status-right "#[none, fg=#{@lavender}] 󰂄 #{battery_percentage}"

# --- Windows ---
setw -g window-status-format \
  "#[none,fg=#{@bg_window},bg=#{@bg_window}]#[none,fg=#{@fg_muted},bg=#{@bg_window}] #I. #W #[none,fg=#{@bg_window},bg=#{@bg_window}]"

setw -g window-status-current-format \
  "#[none,fg=#{@bg_window},bg=#{@highlight_high}]#[none,fg=#{@lavender},bg=#{@highlight_high},bold] #I. #W #[none,fg=#{@highlight_high},bg=#{@bg_window}]"

# load plugins
# this has some duplicated settings but doesn't override
# I should probably take the time to fix this
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-battery'

run '~/.tmux/plugins/tpm/tpm'
